<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>MailSift</title>
    <link rel="icon" type="image/x-icon" href="../static/images/mail.ico">

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link rel="stylesheet" href="../static/css/home.css">
    <style>
        .design {
            width: 100%;
            height: 500px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand disabled" href="#">
                <img src="../static/images/email.png" alt="Icon">
                MailSift
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('mail') }}" target="_blank">Inbox</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        User Input Form
                    </div>
                    <div class="card-body">
                        <form id="dateForm" method="post" action="{{ url_for('date_input') }}"
                            onsubmit="handleFormSubmit(event)">
                            <div class="form-group">
                                <label for="month">Month</label>
                                <select class="form-control" id="month" name="month" required>
                                    <option value="">Select Month</option>
                                    <option value="1">January</option>
                                    <option value="2">February</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="year">Year</label>
                                <select class="form-control" id="year" name="year" required>
                                    <option value="">Select Year</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        User Profile
                    </div>
                    <div class="card-body text-center">
                        <img src="https://via.placeholder.com/100" alt="Profile Picture" class="profile-img">
                        <div class="profile-info">
                            <p>{{ name }}</p>
                            <p>{{ email }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        OpenAI API Key
                    </div>
                    <div class="card-body">
                        <form id="openai-form" onsubmit="showContent(event)">
                            <div class="form-group">
                                <label for="apiKey">OpenAI API Key</label>
                                <input type="text" class="form-control" placeholder="Enter your OpenAI API key"
                                    id="openaiKey">
                            </div>
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" class="btn btn-danger" onclick="clearOutput()">Remove</button>
                        </form>
                    </div>
                    <div class="card-footer">
                        <span style="display: inline-block; vertical-align: middle;">OpenAI Key:</span>
                        <p id="output" style="display: inline-block; vertical-align: middle; margin: 0;"></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-2 mx-auto">
                <div class="card">
                    <div class="card-header">
                        Weather Forecast
                    </div>
                    <div class="card-body weather-body background-img">
                        <p class="date" id="date"></p>
                        <p class="temperature" id="temperature">34</p>
                        <p class="situation" id="weather">weather</p>
                    </div>
                </div>
            </div>

            <div class="col-md-10">
                <div class="card">
                    <div class="card-header">
                        Detailed Analysis
                    </div>
                    <div class="card-body">
                        <p style="font-size: large;">Our analysis offers insights into sender diversity, email
                            distribution over time, peak
                            activity periods, and prevalent topics. Use these insights to optimize your email management
                            and boost productivity.</p>

                        <div class="row">
                            <div class="col-md-3 text-center">
                                <img src="../static/images/man.png" alt="Sender Icon" width="100">
                                <p>Sender Count</p>
                            </div>
                            <div class="col-md-3 text-center">
                                <img src="../static/images/schedule.png" alt="Date Icon" width="100">
                                <p>Date Count</p>
                            </div>
                            <div class="col-md-3 text-center">
                                <img src="../static/images/clock.png" alt="Mails Icon" width="100">
                                <p>Mails per Time</p>
                            </div>
                            <div class="col-md-3 text-center">
                                <img src="../static/images/cloud.png" alt="Word Cloud Icon" width="100">
                                <p>Word Cloud</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="display: block">
            <div class="row mt-4">
                <div class="col-md-6">
                    <div id="chartdiv1" class="design">
                        <script>
                            var sender_count = "{{ sender_count | safe }}";
                        </script>
                    </div>
                </div>
                <div class="col-md-6">
                    <div id="chartdiv2" class="design"></div>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-md-6">
                    <div id="chartdiv3" class="design"></div>
                </div>
                <div class="col-md-6">
                    <div id="chartdiv4" class="design"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="../static/js/home.js"></script>

    <script src="../static/js/graph.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/plugins/wordCloud.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

    <script>
        // JavaScript to populate the month and year dropdown dynamically
        var currentYear = new Date().getFullYear();

        // Dynamically generate the years from 2000 to the current year
        for (var i = currentYear; i >= 2000; i--) {
            var option = document.createElement("option");
            option.text = i;
            option.value = i;
            document.getElementById("year").appendChild(option);
        }

        function handleFormSubmit(event) {
            var month = document.getElementById("month").value;
            var year = document.getElementById("year").value;
            alert('Data generated for ' + month + '/' + year + ' successfully!');
        }
    </script>

    <script>
        // First chart
        am5.ready(function () {

            var root = am5.Root.new("chartdiv1");

            root.setThemes([
                am5themes_Animated.new(root)
            ]);

            var chart = root.container.children.push(am5xy.XYChart.new(root, {
                panX: true,
                panY: true,
                wheelX: "panX",
                wheelY: "zoomX",
                pinchZoomX: true,
                paddingLeft: 0,
                paddingRight: 1
            }));

            var cursor = chart.set("cursor", am5xy.XYCursor.new(root, {}));
            cursor.lineY.set("visible", false);

            var xRenderer = am5xy.AxisRendererX.new(root, {
                minGridDistance: 30,
                minorGridEnabled: true
            });

            xRenderer.labels.template.setAll({
                rotation: -90,
                centerY: am5.p50,
                centerX: am5.p100,
                paddingRight: 15
            });

            xRenderer.grid.template.setAll({
                location: 1
            })

            var xAxis = chart.xAxes.push(am5xy.CategoryAxis.new(root, {
                maxDeviation: 0.3,
                categoryField: "country",
                renderer: xRenderer,
                tooltip: am5.Tooltip.new(root, {})
            }));

            var yRenderer = am5xy.AxisRendererY.new(root, {
                strokeOpacity: 0.1
            })

            var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
                maxDeviation: 0.3,
                renderer: yRenderer
            }));

            var series = chart.series.push(am5xy.ColumnSeries.new(root, {
                name: "Series 1",
                xAxis: xAxis,
                yAxis: yAxis,
                valueYField: "value",
                sequencedInterpolation: true,
                categoryXField: "country",
                tooltip: am5.Tooltip.new(root, {
                    labelText: "{valueY}"
                })
            }));

            series.columns.template.setAll({ cornerRadiusTL: 5, cornerRadiusTR: 5, strokeOpacity: 0 });
            series.columns.template.adapters.add("fill", function (fill, target) {
                return chart.get("colors").getIndex(series.columns.indexOf(target));
            });

            series.columns.template.adapters.add("stroke", function (stroke, target) {
                return chart.get("colors").getIndex(series.columns.indexOf(target));
            });

            var data = sender_count;

            xAxis.data.setAll(data);
            series.data.setAll(data);

            series.appear(1000);
            chart.appear(1000, 100);
        });

        // Second chart
        am5.ready(function () {
            var root = am5.Root.new("chartdiv2");


            var myTheme = am5.Theme.new(root);

            myTheme.rule("Grid", ["base"]).setAll({
                strokeOpacity: 0.1
            });

            root.setThemes([
                am5themes_Animated.new(root),
                myTheme
            ]);

            var chart = root.container.children.push(
                am5xy.XYChart.new(root, {
                    panX: false,
                    panY: false,
                    wheelX: "none",
                    wheelY: "none",
                    paddingLeft: 0
                })
            );

            var yRenderer = am5xy.AxisRendererY.new(root, {
                minGridDistance: 30,
                minorGridEnabled: true
            });
            yRenderer.grid.template.set("location", 1);

            var yAxis = chart.yAxes.push(
                am5xy.CategoryAxis.new(root, {
                    maxDeviation: 0,
                    categoryField: "country",
                    renderer: yRenderer
                })
            );

            var xAxis = chart.xAxes.push(
                am5xy.ValueAxis.new(root, {
                    maxDeviation: 0,
                    min: 0,
                    renderer: am5xy.AxisRendererX.new(root, {
                        visible: true,
                        strokeOpacity: 0.1,
                        minGridDistance: 80
                    })
                })
            );

            var series = chart.series.push(
                am5xy.ColumnSeries.new(root, {
                    name: "Series 1",
                    xAxis: xAxis,
                    yAxis: yAxis,
                    valueXField: "value",
                    sequencedInterpolation: true,
                    categoryYField: "country"
                })
            );

            var columnTemplate = series.columns.template;

            columnTemplate.setAll({
                draggable: true,
                cursorOverStyle: "pointer",
                tooltipText: "drag to rearrange",
                cornerRadiusBR: 10,
                cornerRadiusTR: 10,
                strokeOpacity: 0
            });
            columnTemplate.adapters.add("fill", (fill, target) => {
                return chart.get("colors").getIndex(series.columns.indexOf(target));
            });

            columnTemplate.adapters.add("stroke", (stroke, target) => {
                return chart.get("colors").getIndex(series.columns.indexOf(target));
            });

            columnTemplate.events.on("dragstop", () => {
                sortCategoryAxis();
            });

            function getSeriesItem(category) {
                for (var i = 0; i < series.dataItems.length; i++) {
                    var dataItem = series.dataItems[i];
                    if (dataItem.get("categoryY") == category) {
                        return dataItem;
                    }
                }
            }

            function sortCategoryAxis() {
                series.dataItems.sort(function (x, y) {
                    return y.get("graphics").y() - x.get("graphics").y();
                });

                var easing = am5.ease.out(am5.ease.cubic);

                am5.array.each(yAxis.dataItems, function (dataItem) {
                    var seriesDataItem = getSeriesItem(dataItem.get("category"));

                    if (seriesDataItem) {
                        var index = series.dataItems.indexOf(seriesDataItem);

                        var column = seriesDataItem.get("graphics");

                        var fy =
                            yRenderer.positionToCoordinate(yAxis.indexToPosition(index)) -
                            column.height() / 2;

                        if (index != dataItem.get("index")) {
                            dataItem.set("index", index);

                            // current position
                            var x = column.x();
                            var y = column.y();

                            column.set("dy", -(fy - y));
                            column.set("dx", x);

                            column.animate({ key: "dy", to: 0, duration: 600, easing: easing });
                            column.animate({ key: "dx", to: 0, duration: 600, easing: easing });
                        } else {
                            column.animate({ key: "y", to: fy, duration: 600, easing: easing });
                            column.animate({ key: "x", to: 0, duration: 600, easing: easing });
                        }
                    }
                });

                yAxis.dataItems.sort(function (x, y) {
                    return x.get("index") - y.get("index");
                });
            }

            // Set data
            var data = [{
                country: "USA",
                value: 2025
            }, {
                country: "China",
                value: 1882
            }, {
                country: "Japan",
                value: 1809
            }, {
                country: "Germany",
                value: 1322
            }, {
                country: "UK",
                value: 1122
            }];

            yAxis.data.setAll(data);
            series.data.setAll(data);

            series.appear(1000);
            chart.appear(1000, 100);
        });

        // Third chart
        am5.ready(function () {
            var root = am5.Root.new("chartdiv3");

            root.setThemes([
                am5themes_Animated.new(root)
            ]);

            var chart = root.container.children.push(am5percent.PieChart.new(root, {
                layout: root.verticalLayout,
                innerRadius: am5.percent(50)
            }));

            var series = chart.series.push(am5percent.PieSeries.new(root, {
                valueField: "value",
                categoryField: "category",
                alignLabels: false
            }));

            series.labels.template.setAll({
                textType: "circular",
                centerX: 0,
                centerY: 0
            });

            series.data.setAll([
                { value: 10, category: "One" },
                { value: 9, category: "Two" },
                { value: 6, category: "Three" },
                { value: 5, category: "Four" },
                { value: 4, category: "Five" },
                { value: 3, category: "Six" },
                { value: 1, category: "Seven" },
            ]);

            var legend = chart.children.push(am5.Legend.new(root, {
                centerX: am5.percent(50),
                x: am5.percent(50),
                marginTop: 15,
                marginBottom: 15,
            }));

            legend.data.setAll(series.dataItems);

            series.appear(1000, 100);
        });

        // Fourth chart
        am4core.useTheme(am4themes_animated);
        // Themes end


        var chart = am4core.create("chartdiv4", am4plugins_wordCloud.WordCloud);
        var series = chart.series.push(new am4plugins_wordCloud.WordCloudSeries());

        series.accuracy = 4;
        series.step = 15;
        series.rotationThreshold = 0.7;
        series.maxCount = 200;
        series.minWordLength = 2;
        series.labels.template.tooltipText = "{word}: {value}";
        series.fontFamily = "Courier New";
        series.maxFontSize = am4core.percent(30);

        series.text = "Though yet of Hamlet our dear brother's death The memory be green, and that it us befitted To bear our hearts in grief and our whole kingdom To be contracted in one brow of woe, Yet so far hath discretion fought with nature That we with wisest sorrow think on him, Together with remembrance of ourselves. Therefore our sometime sister, now our queen, The imperial jointress to this warlike state, Have we, as 'twere with a defeated joy,-- With an auspicious and a dropping eye, With mirth in funeral and with dirge in marriage, In equal scale weighing delight and dole,-- Taken to wife: nor have we herein barr'd Your better wisdoms, which have freely gone With this affair along. For all, our thanks. Now follows, that you know, young Fortinbras, Holding a weak supposal of our worth, Or thinking by our late dear brother's death Our state to be disjoint and out of frame, Colleagued with the dream of his advantage, He hath not fail'd to pester us with message, Importing the surrender of those lands Lost by his father, with all bonds of law, To our most valiant brother. So much for him. Now for ourself and for this time of meeting: Thus much the business is: we have here writ To Norway, uncle of young Fortinbras,-- Who, impotent and bed-rid, scarcely hears Of this his nephew's purpose,--to suppress His further gait herein; in that the levies, The lists and full proportions, are all made Out of his subject: and we here dispatch You, good Cornelius, and you, Voltimand, For bearers of this greeting to old Norway; Giving to you no further personal power To business with the king, more than the scope Of these delated articles allow. Farewell, and let your haste commend your duty. Tis sweet and commendable in your nature, Hamlet,To give these mourning duties to your father: But, you must know, your father lost a father; That father lost, lost his, and the survivor bound In filial obligation for some term To do obsequious sorrow: but to persever In obstinate condolement is a course Of impious stubbornness; 'tis unmanly grief; It shows a will most incorrect to heaven, A heart unfortified, a mind impatient, An understanding simple and unschool'd: For what we know must be and is as common As any the most vulgar thing to sense, Why should we in our peevish opposition Take it to heart? Fie! 'tis a fault to heaven, A fault against the dead, a fault to nature, To reason most absurd: whose common theme Is death of fathers, and who still hath cried, From the first corse till he that died to-day, 'This must be so.' We pray you, throw to earth This unprevailing woe, and think of us As of a father: for let the world take note, You are the most immediate to our throne; And with no less nobility of love Than that which dearest father bears his son, Do I impart toward you. For your intent In going back to school in Wittenberg, It is most retrograde to our desire: And we beseech you, bend you to remain Here, in the cheer and comfort of our eye, Our chiefest courtier, cousin, and our son."; 
    </script>
</body>

</html>